<h2>Data Loaded:</h2>
@* <pre>@ViewData["DataJson"]</pre>
 *@


<!-- Your Grid -->
<div id="myGrid" class="ag-theme-alpine" style="height: 400px; width: 100%;"></div>

<script src="https://cdn.jsdelivr.net/npm/ag-grid-community/dist/ag-grid-community.min.js"></script>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        const gridDiv = document.querySelector('#myGrid');

        // 1️⃣ Fetch data from your API first
        fetch("/api/GetData/server")
            .then(res => {
                if (!res.ok) throw new Error("Failed to fetch grid data");
                return res.json();
            })
            .then(rowData => {
                // 2️⃣ Initialize grid with fetched data
                const gridOptions = {
                    columnDefs: rowData.Columns, // ✅ use the fetched data here,
                    defaultColDef: {
                        flex: 1,
                        sortable: true,
                        filter: true
                    },
                    rowData: rowData.Data, // ✅ use the fetched data here
                    overlayLoadingTemplate: '<span class="ag-overlay-loading-center">Loading...</span>',
                    overlayNoRowsTemplate: '<span class="ag-overlay-loading-center">No data available</span>'
                };

                // 3️⃣ Create the grid
                agGrid.createGrid(gridDiv, gridOptions);
            });
    });
</script>